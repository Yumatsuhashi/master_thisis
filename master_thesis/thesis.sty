% ----------------------------------------------------------- %
% 修士論文用スタイルファイル
% 作成者：神田 敦，松本 延孝，鹿島 拓也？
% 作成日：2007年1月19日
% 改変 by 石田繁巳
% ■2008年1月17日，2008年1月19日
%   chapterに引数を追加し，名言を挿入できるようにした．
%   \@makemeigen参照のこと．
%   chapter*がoverfull hboxになるのを回避．
% ■2012年5月25日
%   publicationを項目毎にsectionで区切れるようにするため，
%   publicationの定義から自動chapter*生成を削除．
% ■2012年5月31日
%   publicationページのヘッダは右側だけに記載するように修正．
% ----------------------------------------------------------- %
% このスタイルファイルは
% 神田が松本さんや鹿島さんが作成・利用していたスタイルファイル
% を参考にして作成しました．
%
% 表紙：鹿島さんスタイルをベースに改造
% 章表紙：松本さんスタイルをそのまま利用
% ヘッダ・フッタ：神田が作成
% 発表文献：神田が作成
% ----------------------------------------------------------- %
% 対象クラスはjreport, jbook（未確認）, jsbookなど
%
% 使い方例：
% \documentclass[a4j, report]{jsbook}
% \usepackage{master_thesis}


%--------------------------------------------------------------
%表紙
%
%かならず以下の項目をすべて定義すること（使わない場合は空欄にする）
%\title{タイトル}
%\subtitle{サブタイトル，英訳タイトルなど}
%\ID{学籍番号}
%\author{氏名}
%\professor{森川~博之 \ 教授}
%\professorii{}
%\faculty{東京大学大学院~新領域創成科学研究科}
%\department{基盤情報学専攻}
%\date{平成 19 年 1 月 31 日}
%
%挿入したい場所で\maketitle
%
%--------------------------------------------------------------
\def\p@thanks#1{\footnotemark
  \protected@xdef\@thanks{\@thanks
    \protect{\noindent$\m@th^\thefootnote$~#1\protect\par}}}
  \renewcommand{\maketitle}{\par
  \begingroup
    \parskip 0em
    \renewcommand{\thefootnote}{\fnsymbol{footnote}}%
    \def\@makefnmark{\hbox{\ifydir $\m@th^{\@thefnmark}$
      \else\hbox{\yoko$\m@th^{\@thefnmark}$}\fi}}%
     \long\def\@makefntext##1{\parindent 1em\noindent
       \hbox to1.8em{\hss$\m@th^{\@thefnmark}$}##1}%
    \if@twocolumn
      \ifnum \col@number=\@ne \@maketitle
      \else \twocolumn[\@maketitle]%
      \fi
    \else
      \newpage
      \global\@topnum\z@   % Prevents figures from going at top of page.
      \@maketitle
    \fi
    \thispagestyle{empty}\@thanks
  \endgroup
  \setcounter{footnote}{0}%
  \global\let\thanks\relax
  \global\let\maketitle\relax
  \global\let\p@thanks\relax
  \global\let\@thanks\@empty
  \global\let\@author\@empty
%%
  \global\let\@affliate\@empty
%%
  \global\let\@date\@empty
  \global\let\@title\@empty
  \global\let\title\relax
  \global\let\author\relax
%%
  \global\let\affliate\relax
%%
  \global\let\date\relax
  \global\let\and\relax
  }
  \font\ut=utokyo scaled \magstep 0       % 1000 (300 pk \normalsize)
  \font\utm=utokyo scaled \magstephalf    % 1095 (329 pk)
  \font\utl=utokyo scaled \magstep 1      % 1200 (360 pk, \large)
  \font\utL=utokyo scaled \magstep 2      % 1440 (432 pk, \Large)
  \font\utLL=utokyo scaled \magstep 3     % 1728 (518 pk, \LARGE)
  \font\uth=utokyo scaled \magstep 4      % 2074 (622 pk, \huge)
  \font\utH=utokyo scaled \magstep 5      % 2487 (746 pk, \Huge)
%%
  \font\minL=min10 at 36pt
  \font\cmrL=cmr10 at 36pt
  \def\Big{\minL\cmrL}
  \font\minLL=min10 at 72pt
  \font\cmrLL=cmr10 at 72pt
  \def\BIG{\minLL\cmrLL}
%%
  \def\subtitle#1{\gdef\@subtitle{#1}}
  \def\professor#1{\gdef\@professor{#1}}
  \def\professorii#1{\gdef\@professorii{#1}}%%
  \def\faculty#1{\gdef\@faculty{#1}}
  \def\department#1{\gdef\@department{#1}}
  \def\ID#1{\gdef\@ID{#1}}
  \def\offset{1.0}
  \def\@tskip{\hskip 0.5in}
  \def\@maketitle{%
  \newpage\null
  \let\footnoterule\relax \setcounter{page}{0}%
  \thispagestyle{empty}%
  \vskip 0.8in
  %
  \begin{center}%
      \vskip -0.8in
      %----- 修士論文 -----
      {\Big 修{\hskip 2em}士{\hskip 2em}論{\hskip 2em}文}\par
      %--------------------
      \vskip 0.6in
      %----- 題目 ------
      {\Huge\bfseries \@title}\par
      \vskip 0.1in
      {\huge\bfseries \@subtitle}\par
      %-----------------
      %\vfill
      \vskip 0.5in
      %----- 指導教員 -----
      \@tskip\hfill\makebox[1in]{\hfill{\huge 指導教員}\hfill}\hfill
        \begin{tabular}[t]{l}
          {\huge\bfseries \@professor}\\
          {\huge\bfseries \@professorii}  
        \end{tabular}\hfill\@tskip\strut\par
      %--------------------
%      \vfill
      \vskip 1in
      %----- ロゴマーク + 所属 -----
%      \@tskip\hfill
        %% 旧東大マーク
        %\makebox[1in]{\hfill\raise-8ex\hbox{\utL T}\hfill}\hfill
        % 新東大マーク
        \makebox[1in]{\hfill\raise-4ex\hbox{\includegraphics{utlogo.eps}}\hfill}\hfill
        \begin{tabular}{c}
         {\LARGE\bfseries \@faculty}\\
         {\LARGE\bfseries \@department}
        \end{tabular}
%      \hfill\@tskip\strut\par
      %-----------------------------
      \vfill
      %----- 氏名 + 提出日-----
%      \@tskip\hfill{\huge \@ID}\hfill{\huge \@author}\hfill\@tskip\par
%      \vskip 0.4in

      \@tskip\hfill
        {\def\arraystretch{3}
        \begin{tabular}{c}
         {\huge 氏~~名}\\
	 {\huge 提~~出~~日}
	\end{tabular}\hfill
        \begin{tabular}{l}
          {\underline{\huge\bfseries \@ID{\hskip 1em}\@author}}\\
	  {\huge\bfseries \@date}
        \end{tabular}
        }
      \hfill\@tskip\strut\par

%      \@tskip\hfill\makebox[1in]{\hfill{\huge 氏~~名}\hfill}\hfill
%        {\huge \@ID}\hfil{\huge \@author}\hfill\@tskip\strut\par
%      \vskip 0.4in
%      \@tskip\hfill\makebox[1in]{\hfill{\huge 提~~出~~日}\hfill}\hfill
%        {\huge \@date}\hfill\@tskip\strut\par
      %------------------------
    \end{center}
    \vskip 0.8in}%
%--------------------------------------------------------------
%ページスタイルの定義（ヘッダ，フッタなど）
%
%\pagestyle{footandheadings}
%\thispagestyle{footandheadings}
%--------------------------------------------------------------
\if@twoside
  \def\ps@footandheadings{%
    \def\@oddfoot{\normalfont\hfil -~\thepage~- \hfil}%
    \let\@evenfoot\@oddfoot
    \def\@evenhead{\if@mparswitch \hss \fi
      \underline{
         \hbox to \fullwidth{\textbf{\thepage}\hfil\leftmark}}%
      \if@mparswitch\else \hss \fi}%
    \def\@oddhead{%
      \underline{%
        \hbox to \fullwidth{{\rightmark}\hfil\textbf{\thepage}}}\hss}%
    \let\@mkboth\markboth
    \def\chaptermark##1{\markboth{%
       \ifnum \c@secnumdepth >\m@ne
         \if@mainmatter
           \@chapapp\thechapter\@chappos\hskip1zw
         \fi
       \fi
       ##1}{}}%
  }
\else % if not twoside
  \def\ps@footandheadings{%
    \def\@oddfoot{\normalfont\hfil --~\thepage~-- \hfil}%
    \def\@oddhead{%
      \underline{%
        \hbox to \fullwidth{{\rightmark}\hfil{\leftmark}}\hss}}%
    \let\@mkboth\markboth
    \def\chaptermark##1{\markboth{%
       \ifnum \c@secnumdepth >\m@ne
         \if@mainmatter
           \@chapapp\thechapter\@chappos\hskip1zw
         \fi
       \fi
       ##1}{}}%
    \def\sectionmark##1{\markright{%
       \ifnum \c@secnumdepth >\z@ \thesection \hskip1zw\fi
       ##1}}%
%    \def\subsectionmark##1{\markright{%
%       \ifnum \c@secnumdepth >\@ne \thesubsection \hskip1zw\fi
%       ##1}}%
  }
\fi

\def\ps@plainfoot{%
  \let\@mkboth\@gobbletwo
  \let\@oddhead\@empty
  \def\@oddfoot{\normalfont\hfil --~\thepage~-- \hfil}%
  \let\@evenhead\@empty
  \let\@evenfoot\@oddfoot}
%--------------------------------------------------------------
%chapterの再定義
%--------------------------------------------------------------

% 旧章表紙（神田作成）
%\renewcommand{\chapter}{%
%  \if@openright\cleardoublepage\else\clearpage\fi
%  \thispagestyle{plainfoot}
%  \global\@topnum\z@
%  \secdef\@chapter\@schapter}
%
%\newcommand{\chapterpage}[1]{%
%  \chapter{#1}
%  \vskip 1in
%  \hrule height1pt\hfill
%  \clearpage
%}%

% 章表紙（松本さん作成）
% 章タイトル出力コマンド
\renewcommand{\chapter}{%
  \if@openright\cleardoublepage\else\clearpage\fi
  \thispagestyle{plainfoot}
  \global\@topnum\z@
  \@afterindentfalse
  \secdef\@chapter\@schapter}
% *がない場合のコマンド
\def\@chapter[#1]#2#3{%
  \thispagestyle{empty}
  \ifnum \c@secnumdepth >\m@ne
    \refstepcounter{chapter}%
    \typeout{\@chapapp\space\thechapter\space\@chappos}%
    \addcontentsline{toc}{chapter}%
      {\protect\numberline{\@chapapp\thechapter\@chappos}#1}%
  \else
    \addcontentsline{toc}{chapter}{#1}%
  \fi
  \chaptermark{#1}%
  \addtocontents{lof}{\protect\addvspace{10\p@}}%
  \addtocontents{lot}{\protect\addvspace{10\p@}}%
  \@makechapterhead{#2}\vfill\@makemeigen{#3}\@afterheading\clearpage} % ここに改ページを挿入
% *がない場合のコマンド(実体)
\def\@makechapterhead#1{\hbox{}%
  \vskip4\Cvs
  {\parindent\z@
   \vrule width 8pt
   \hspace{8pt}
   \raggedright
   \reset@font\Huge\bfseries
   \leavevmode
   \ifnum \c@secnumdepth >\m@ne
     \setlength\@tempdima{\linewidth}%
     \setbox\z@\hbox{\rule[-0.7ex]{0pt}{2.5ex}\@chapapp\thechapter\@chappos\hskip1zw}%
     \addtolength\@tempdima{-\wd\z@}%
     \unhbox\z@\nobreak
     \hrule height 1pt
     \vspace{5pt}
     \hfill
     % もし#1の長さが\@tempdimaより長かったらflushleftで出力
     % そうでなければflushrightで出力
     \setbox\z@\hbox{#1}
     \ifnum \wd\z@ > \@tempdima
        \vtop{\hfill\hsize\@tempdima\flushleft{#1}}
     \else
        \vtop{\hfill\hsize\@tempdima\flushright{#1}}
     \fi
%     \vtop{\hfill\hsize\@tempdima\flushleft{#1}}%
   \else
     #1\relax
   \fi}}  % ここでclearpageすると次のページの書き出しの位置が上がってしまう
%   \fi}\clearpage}  % 番号付きの章だけ改ページされた(ただし目次も変に)
%   \fi}\nobreak\vskip3\Cvs}
% 名言コマンド（くだらねぇ・・・）
\def\@makemeigen#1{%
  \@makemeigenhead{#1}\@afterheading
}
\def\@makemeigenhead#1{\hbox{}%
  \vskip\Cvs
  {\parindent\z@
    \vtop{\hfill\flushright\textit{#1}}
  }
  \vskip2\Cvs
}

% *がある場合のコマンド
\def\@schapter#1{%
  \@makeschapterhead{\rule[-0.7ex]{0pt}{2.5ex}#1}\@afterheading
}
% *がある場合のコマンド(実体)
\def\@makeschapterhead#1{\hbox{}%
  \vskip2\Cvs
  {\parindent\z@
   \vrule width 8pt
   \hspace{8pt}
   \raggedright
   \reset@font\Huge\bfseries
   \leavevmode
   \setlength\@tempdima{\linewidth}%
   \setbox\z@\hbox{#1}%
   \addtolength\@tempdima{-\wd\z@}%
   \vtop{\hsize\@tempdima#1}}
   \hrule height 1pt
   \vskip3\Cvs}


%--------------------------------------------------------------
%参考文献関連
%--------------------------------------------------------------
\renewcommand{\refname}{\if@english References\else 参考文献\fi}
\renewcommand{\bibname}{\if@english References\else 参考文献\fi}

%--------------------------------------------------------------
%謝辞関連
%--------------------------------------------------------------
\newcommand\thanksname{\if@english Acknowledgments\else 謝辞\fi}

%--------------------------------------------------------------
%発表文献(publication)の定義
%--------------------------------------------------------------
\newcounter{pnumiv}
\renewcommand{\thepnumiv}{\@Alph\c@pnumiv}
\renewcommand{\labelenumiv}{\thepnumiv.}
\newcommand{\publicationname}{\if@english Publications\else 発表文献\fi}
\def\@publabel#1{[#1]}
\newenvironment{publication}[1]{%
  \global\let\presectionname\relax
  \global\let\postsectionname\relax
  \@mkboth{\publicationname}{}%
   \list{\@publabel{\@arabic\c@pnumiv}}%
        {\settowidth\labelwidth{\@publabel{#1}}%
         \leftmargin\labelwidth
         \advance\leftmargin\labelsep
         \@openbib@code
         %%%
         %\usecounter{pnumiv}%
         % ↑環境毎にカウンタをクリア ↓クリアしない
         \@nmbrlisttrue\def\@listctr{pnumiv}%
         %%%
         \let\p@pnumiv\@empty
         \renewcommand\thepnumiv{\@arabic\c@pnumiv}}%
   \sloppy
   \clubpenalty4000
   \@clubpenalty\clubpenalty
   \widowpenalty4000%
   \sfcode`\.\@m}
  {\def\@noitemerr
    {\@latex@warning{Empty `publication' environment}}%
   \endlist}
%--------------------------------------------------------------
%\vdotsの上下間隔狭めた関数
%--------------------------------------------------------------
\def\nvdots{
\vskip -1zh
\vdots
\vskip -1zh}
%--------------------------------------------------------------
%その他パラメータの調整
%--------------------------------------------------------------
\setcounter{secnumdepth}{3}

%\setlength\oddsidemargin{30.1mm}
%\setlength\evensidemargin{30.1mm}
%\setlength\textwidth{\paperwidth}
%\addtolength\textwidth{-\oddsidemargin}
%\addtolength\textwidth{-\evensidemargin}
%\addtolength\oddsidemargin{-1in}
%\addtolength\evensidemargin{-1in}
%\setlength\headsep{15mm}
\setlength\headsep{10mm}
%\setlength\textheight{\paperheight}
%\addtolength\textheight{-\topmargin}
%\addtolength\textheight{-\headheight}
%\addtolength\textheight{-\headsep}
%\addtolength\textheight{-45mm}
%\addtolength\textheight{-1in}
%\setlength\footskip{40pt}
\setlength\footskip{12mm}

\raggedbottom
\if@twocolumn
  \twocolumn
  \sloppy
  \flushbottom
\else
  \onecolumn
\fi
\if@twoside
  \@mparswitchtrue
\else
  \@mparswitchfalse
\fi


\endinput
